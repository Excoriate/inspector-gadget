name: ğŸ³ Docker CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

env:
  CARGO_TERM_COLOR: always

jobs:
  docker-ci:
    name: ğŸ³ Docker Build and Test
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ“¥ Checkout repository
        uses: actions/checkout@v4

      - name: ğŸ³ Set up Docker Buildx
        uses: docker/setup-buildx-action@v3

      - name: ğŸ—ï¸ Build Docker image
        run: |
          echo "ğŸ”¨ Building Docker image..."
          docker build -t inspector-cli .
          echo "âœ… Docker image built successfully"

      - name: ğŸ§ª Test Docker image
        run: |
          echo "ğŸƒâ€â™‚ï¸ Running CLI in Docker container..."
          docker run --rm inspector-cli --help
          echo "âœ… Docker image test passed"

      - name: ğŸš€ Run CLI tests in Docker
        run: |
          echo "ğŸƒâ€â™‚ï¸ Running CLI tests in Docker container..."
          docker run --rm inspector-cli sh -c "just test-cli-terragrunt"
          echo "âœ… CLI tests in Docker completed successfully"

      - name: ğŸ‰ Docker CI Success Notification
        if: success()
        run: |
          echo "::notice::ğŸŠ Docker CI checks passed successfully!"

      - name: âŒ Docker CI Failure Notification
        if: failure()
        run: |
          echo "::error::ğŸ’¥ Docker CI checks failed. Please review the logs for details."